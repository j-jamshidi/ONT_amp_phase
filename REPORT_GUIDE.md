# Report Guide

This guide explains the content of the analysis reports generated by the ONT Amplicon Phasing Pipeline. The report format varies depending on the analysis mode (0, 1, or 2 variants).

## Report Types

### 1. QC-Only Analysis (0 or 1 variant)
**Triggered when:** No variants provided OR only one variant provided in sample sheet

### 2. Phasing Analysis (2 variants)
**Triggered when:** Two variants provided in sample sheet

---

## QC-Only Report Structure

### Header Section
```
Report for {Episode}
------------------------------
Amplicon region: chr:start-end
Amplicon length: xx bp
Total reads: xx
Passing QC reads: xx (xx%)

*QC PASSED (>50 HQ reads and minimum depth >50x)*
```

**QC Status Criteria:**
- **PASSED**: >50 high-quality reads AND minimum depth >50x
- **FAILED**: <50 high-quality reads OR minimum depth <50x

### Variant Calling Section (if variant provided)
```
=== Variant Calling ===
User provided variant:
chr4    41638861    C    T

Variants called from the amplicon by Clair3:
chr4    41638861    C    T
chr4    41651881    G    A

Variant Matching:
Variant 1: chr4 41638861 C > T - FOUND
```

### Quality Control Details
```
==Quality control details==
Depth Statistics:
Median depth: 127X
Minimum depth: 89X
Maximum depth: 156X

Read Length Distribution:
Median length: 14,203
Mean length: 14,156
Length N50: 14,298

Mapping Quality:
Mean MAPQ: 60
Reads with MAPQ≥20: 1,247 (100%)

Base Quality:
Mean base quality: 12
Median base quality: 12

Alignment Statistics:
Mean identity: 95%
Reads ≥80% identity: 1,247 (100%)

Strand Distribution:
Forward: 623 (50%)
Reverse: 624 (50%)
```

---

## Phasing Report Structure

### Header Section
```
Report for: NA24385_1
------------------------------
Amplicon region: chr21:42375008-42389474
Amplicon length: 14,466 bp
Variant 1: chr21:42375588 G>A
Variant 2: chr21:42388818 A>G
Distance between variants: 13230 bp
```

### Variant Validation
```
=== Variant Validation ===
Variants were validated successfully
Both variants show expected heterozygous patterns in the reads.
```
**Possible validation outcomes:**
- **Success**: Variants show expected heterozygous patterns
- **Warning**: Skewed allele frequencies (80-95% for one allele)
- **Error**: Homozygous patterns (>95% for one allele) or insufficient coverage (<30 reads)

### Quality Control Section
```
=== Quality Control ===
Total reads: 1,247
Spanning reads: 892 (71.53%)
Clean spanning reads: 856 (95.95% of spanning reads)
High quality spanning reads (MAPQ >= 20): 834 (97.43% of clean spanning reads)

*QC PASSED (>50 high quality spanning reads)*
```
**Read Categories:**
- **Total reads**: All reads in amplicon region
- **Spanning reads**: Reads covering both variant positions
- **Clean spanning reads**: Spanning reads where both variants can be confidently called
- **High quality spanning reads**: Clean spanning reads with MAPQ ≥ 20

### Variant Calling Section
```
===Variant Calling===
Variants called from the amplicon by Clair3:
CHROM    POS         REF    ALT    QUAL    GT
chr4     41638861    C      T      60.0    0/1 <-
chr4     41651871    G      A      58.5    0/1 
chr4     41651881    G      A      58.5    0/1 <-

Variant Matching Results:
Variant 1: chr4 41638861 C > T - FOUND
Variant 2: chr4 41651881 G > A - FOUND
```

**Indicators:**
- `<-` : Variant matches user-provided variant
- ` ` : Variant not in user-provided list


### Phasing Results
```
=== Result ===
Total high quality spanning reads: 834

Detailed categorisation of reads:
Reads with ref allele for both variants (Cis): 412 (49.40%)
Reads with alt allele for both variants (Cis): 398 (47.72%)
Reads with ref for first, alt for second (Trans): 14 (1.68%)
Reads with alt for first, ref for second (Trans): 10 (1.20%)

Cis reads (both ref or both alt): 810 (97.12%)
Trans reads (one ref, one alt): 24 (2.88%)

Counting the reads determined the phase as Cis

Chimeric reads percentage: 2.88%
```

### Tool-Specific Results
```
WhatsHap analysis determined the phase as Cis

HapCUT2 analysis determined the phase as Cis
```

---

## Key Metrics Explained

### Quality Metrics
- **MAPQ**: Mapping quality score (≥20 considered high quality)
- **Read Identity**: Percentage of bases matching reference (≥80% considered good)
- **N50**: Length at which 50% of total sequence length is contained in reads of this length or longer
- **Base Quality**: Phred quality scores for individual bases

### Phasing Metrics
- **Cis Configuration**: Both variants on same chromosome (both ref OR both alt)
- **Trans Configuration**: Variants on different chromosomes (one ref AND one alt)
- **Chimeric Reads**: Reads showing minority phasing pattern (potential PCR artifacts)

### Coverage Thresholds
- **Minimum Coverage**: 30 reads per variant position
- **QC Passing**: >50 high-quality spanning reads
- **Depth Threshold**: >50x minimum depth across amplicon

---

## Troubleshooting Report Issues

### Common Warning Messages

**"QC FAILED (Minimum depth <50x)"**
- Low yield PCR, repeat the PCR
- Check amplicon coordinates match PCR design

**"Variant validation failed"**
- Verify variant coordinates and alleles
- Check if variants are actually heterozygous in sample

**"Skewed allele frequencies"**
- May indicate allele dropout or contamination
- Consider technical replicates

**"Chimeric reads percentage: >40%"**
- High chimeric rate may indicate PCR artifacts
- Consider optimizing PCR conditions

### Error Conditions

**"Insufficient coverage at position"**
- Variant position not adequately covered
- Wrong variant position or alleles specified
- Check amplicon design and variant coordinates

**"Unexpected alleles found"**
- Wrong variant position or alleles specified
- Verify variant information against reference genome

**"No high quality spanning reads found"**
- Poor read quality or amplicon design issues
- Check sequencing quality and amplicon length
- Wrong variant position or alleles specified