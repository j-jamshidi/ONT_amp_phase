# Report Guide

This guide explains the content of the analysis reports generated by the ONT Amplicon Phasing Pipeline. The report format varies depending on the analysis mode (0, 1, or 2 variants).

## Report Types

### 1. QC-Only Analysis (0 or 1 variant)
**Triggered when:** No variants provided OR only one variant provided in sample sheet

### 2. Phasing Analysis (2 variants)
**Triggered when:** Two variants provided in sample sheet

---

## QC-Only Report Structure

### Header Section
```
Report for {Episode}
------------------------------
Amplicon region: chr:start-end
Amplicon length: xx bp
Total reads: xx
Passing QC reads: xx (xx%)

*QC PASSED (>50 HQ reads and minimum depth >50x)*
```
- **Report for**: Sample identifier from the `Episode` column in sample sheet
- **Amplicon region**: Genomic coordinates of the target amplicon (chromosome:start-end)
- **Amplicon length**: Size of the target region in base pairs
- **Total reads**: All reads in amplicon region
- **Passing QC reads**: Reads passing quality control (>1000 bp, MAPQ ≥ 20, base quality ≥ 10)
- **QC PASSED**: Indicates whether the sample passed the quality control criteria


**QC Status Criteria:**
- **PASSED**: >50 high-quality reads AND minimum depth >50x
- **FAILED**: <50 high-quality reads OR minimum depth <50x

### Variant Calling Section (if variant provided)
```
=== Variant Calling ===
User provided variant:
chr4    41638861    C    T

Variants called from the amplicon by Clair3:
chr4    41638861    C    T <-
chr4    41651881    G    A

Variant Matching:
Variant 1: chr4 41638861 C > T - FOUND
```
**Clair3 Variant Table:**
- **CHROM**: Chromosome
- **POS**: Position on chromosome
- **REF**: Reference allele
- **ALT**: Alternate allele
- **QUAL**: Variant quality score (higher = more confident)
- **GT**: Genotype (0/1 = heterozygous, 0/0 = homozygous reference, 1/1 = homozygous alternate)
- **← Arrow**: Indicates user-specified variants found by Clair3

**Variant Matching Results:**
- **FOUND**: User variant matches a Clair3-called variant
- **NOT FOUND**: User variant not detected by Clair3 (may indicate low coverage or sequencing issues)


### Quality Control Details
```
==Quality control details==
Depth Statistics:
Median depth: X
Minimum depth: X
Maximum depth: X

Read Length Distribution:
Median length: 
Mean length: 
Length N50: 

Mapping Quality:
Mean MAPQ: 
Reads with MAPQ≥20: 

Base Quality:
Mean base quality: 
Median base quality: 

Alignment Statistics:
Mean identity: 
Reads ≥80% identity: 

Strand Distribution:
Forward: 
Reverse: 
```
- **Depth Statistics**: Provides the median, minimum, and maximum sequencing depth across the target region, reflecting coverage uniformity and identifying potential dropouts.
- **Read Length Distribution**: Reports the median and mean read lengths, as well as the N50 metric, offering insight into the size distribution and quality of sequencing fragments.
- **Mapping Quality**: Summarizes the average mapping quality score and enumerates reads with MAPQ ≥ 20, indicating the reliability of read alignment to the reference genome.
- **Base Quality**: Details the mean and median base quality scores, representing the confidence in individual base calls throughout the dataset.
- **Alignment Statistics**: Presents the average alignment identity and the proportion of reads with ≥80% identity, assessing the accuracy of read-to-reference mapping.
- **Strand Distribution**: Quantifies the coverage contributed by reads mapped to the forward and reverse DNA strands, enabling evaluation of strand bias in the sequencing data.

---

## Phasing Report Structure

### Header Section
```
Report for: NA24385_1
------------------------------
Amplicon region: chr21:42375008-42389474
Amplicon length: 14,466 bp
Variant 1: chr21:42375588 G>A
Variant 2: chr21:42388818 A>G
Distance between variants: 13230 bp
```
- **Report for**: Sample identifier from the `Episode` column in sample sheet
- **Amplicon region**: Genomic coordinates of the target amplicon (chromosome:start-end)
- **Amplicon length**: Size of the target region in base pairs
- **Variant 1/2**: User-specified variants in format `chromosome:position reference>alternate`
- **Distance between variants**: Physical distance between the two variants on the genome

### Variant Validation
```
=== Variant Validation ===
Variants were validated successfully
Both variants show expected heterozygous patterns in the reads.
```
**Possible validation outcomes:**
- **Success**: Variants show expected heterozygous patterns
- **Warning**: Skewed allele frequencies (80-95% for one allele)
- **Error**: Homozygous patterns (>95% for one allele) or insufficient coverage (<30 reads)

### Quality Control Section
```
=== Quality Control ===
Total reads: 1,247
Spanning reads: 892 (71.53%)
Clean spanning reads: 856 (95.95% of spanning reads)
High quality spanning reads (MAPQ >= 20): 834 (97.43% of clean spanning reads)

*QC PASSED (>50 high quality spanning reads)*
```
**Read Categories:**
- **Total reads**: All reads in amplicon region
- **Spanning reads**: Reads covering both variant positions
- **Clean spanning reads**: Spanning reads where both variants can be confidently called
- **High quality spanning reads**: Clean spanning reads with MAPQ ≥ 20

**Pass/Fail Criteria:**
- **PASS**: ≥50 high quality spanning reads
- **FAIL**: <50 high quality spanning reads (insufficient data for reliable phasing)


### Variant Calling Section
```
===Variant Calling===
Variants called from the amplicon by Clair3:
CHROM    POS         REF    ALT    QUAL    GT
chr4     41638861    C      T      60.0    0/1 <-
chr4     41651871    G      A      58.5    0/1 
chr4     41651881    G      A      58.5    0/1 <-

Variant Matching Results:
Variant 1: chr4 41638861 C > T - FOUND
Variant 2: chr4 41651881 G > A - FOUND
```

**Clair3 Variant Table:**
- **CHROM**: Chromosome
- **POS**: Position on chromosome
- **REF**: Reference allele
- **ALT**: Alternate allele
- **QUAL**: Variant quality score (higher = more confident)
- **GT**: Genotype (0/1 = heterozygous, 0/0 = homozygous reference, 1/1 = homozygous alternate)
- **← Arrow**: Indicates user-specified variants found by Clair3

**Variant Matching Results:**
- **FOUND**: User variant matches a Clair3-called variant
- **NOT FOUND**: User variant not detected by Clair3 (may indicate low coverage or sequencing issues)


### Phasing Results
```
=== Result ===
Total high quality spanning reads: 834

Detailed categorisation of reads:
Reads with ref allele for both variants (Cis): 412 (49.40%)
Reads with alt allele for both variants (Cis): 398 (47.72%)
Reads with ref for first, alt for second (Trans): 14 (1.68%)
Reads with alt for first, ref for second (Trans): 10 (1.20%)

Cis reads (both ref or both alt): 810 (97.12%)
Trans reads (one ref, one alt): 24 (2.88%)

Counting the reads determined the phase as Cis

Chimeric reads percentage: 2.88%
```

### Tool-Specific Results
```
WhatsHap analysis determined the phase as Cis

HapCUT2 analysis determined the phase as Cis
```
#### Read Categorization
**Cis Configuration** 
1. **Both Reference (Ref-Ref)**: 
   - Both variants show reference allele on same DNA molecule
2. **Both Alternate (Alt-Alt)**: 
   - Both variants show alternate allele on same DNA molecule

**Trans Configuration** (Different Chromosomes)
1. **Ref-Alt**: 
   - First variant = reference, second variant = alternate
2. **Alt-Ref**:
   - First variant = alternate, second variant = reference

#### Phase Configuration Summary Statistics
- **Total Cis**: variants on same chromosome
- **Total Trans**: variants on different chromosomes

#### Chimeric Reads
- **Definition**: Reads showing a discordant phase (i.e., not matching the main phase configuration)
- **Interpretation**: 
   - Acceptable percentage (≤40%): Within expected range for technical noise
   - High percentage (>40%): Warning—may indicate technical issues or unreliable phasing results

---

## Key Metrics Explained

### Quality Metrics
- **MAPQ**: Mapping quality score (≥20 considered high quality)
- **Read Identity**: Percentage of bases matching reference (≥80% considered good)
- **N50**: Length at which 50% of total sequence length is contained in reads of this length or longer
- **Base Quality**: Phred quality scores for individual bases

### Phasing Metrics
- **Cis Configuration**: Both variants on same chromosome (both ref OR both alt)
- **Trans Configuration**: Variants on different chromosomes (one ref AND one alt)
- **Chimeric Reads**: Reads showing minority phasing pattern (potential PCR artifacts)

### Coverage Thresholds
- **Minimum Coverage**: 30 reads per variant position
- **QC Passing**: >50 high-quality spanning reads
- **Depth Threshold**: >50x minimum depth across amplicon

---

## Troubleshooting Report Issues

### Common Warning Messages

**"QC FAILED (Minimum depth <50x)"**
- Low yield PCR, repeat the PCR
- Check amplicon coordinates match PCR design

**"Skewed allele frequencies"**
- May indicate allele dropout or contamination
- Consider technical replicates

**"Chimeric reads percentage: >40%"**
- High chimeric rate may indicate PCR artifacts
- Consider optimizing PCR conditions

### Error Conditions

**"Variant validation failed"**
- Verify variant coordinates and alleles
- Check if variants are actually heterozygous in sample

**"Insufficient coverage at position"**
- Variant position not adequately covered
- Wrong variant position or alleles specified
- Check amplicon design and variant coordinates

**"Unexpected alleles found"**
- Wrong variant position or alleles specified
- Verify variant information against reference genome

**"No high quality spanning reads found"**
- Poor read quality or amplicon design issues
- Check sequencing quality and amplicon length
- Wrong variant position or alleles specified